<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Duration Calculator</title>
</head>
<body>
    <div id="TimeCalculatorContainer"></div>

    <script>
        document.getElementById('TimeCalculatorContainer').innerHTML = `
        <div class="time-calculator-container">
            <h2>Time Duration Calculator</h2>
            <div class="time-calculator-straight-line"></div>
            
            <div class="time-blocks-container" id="timeBlocksContainer">
                <!-- Time blocks will be added here -->
            </div>
            
            <button id="addTimeBlockBtn" class="time-calculator-secondary-btn" style="margin-top: 15px;">+ Add Another Time Block</button>
            
            <div class="time-calculator-options-row">
                <label>Time Format:
                    <select id="timeCalculatorFormat">
                        <option value="24">24-hour</option>
                        <option value="12" selected>12-hour (AM/PM)</option>
                    </select>
                </label>
                <label><input type="checkbox" id="timeCalculatorIncludeSeconds"> Include Seconds</label>
            </div>
            
            <div class="time-calculator-button-row">
                <button id="timeCalculatorCalcBtn" class="time-calculator-primary-btn">Calculate Total</button>
                <button id="timeCalculatorResetBtn" class="time-calculator-secondary-btn">Reset</button>
            </div>
            
            <div id="timeCalculatorError" class="time-calculator-error"></div>
            <div id="timeCalculatorOutput" class="time-calculator-result-block"></div>
        </div>
        `;

        // Add CSS with proper scoping
        const style = document.createElement('style');
        style.textContent = `
        #TimeCalculatorContainer .time-calculator-container {
            max-width: 500px;
            margin: 40px auto;
            background: #f9f6ee;
            border-radius: 5px;
            padding: 26px 24px;
            border: none;
            box-shadow: 0 2px 12px rgba(173,42,36,0.08);
            font-family: 'Georgia', serif;
        }

        #TimeCalculatorContainer .time-calculator-container h2 {
            margin: 0 0 12px;
            font-size: 2em;
            color: #553a4d;
            font-weight: bold;
            text-align: center;
        }

        #TimeCalculatorContainer .time-calculator-straight-line {
            height: 3px;
            background: #d4c9a8;
            border-radius: 2px;
            margin: 8px 0 12px;
        }

        #TimeCalculatorContainer .time-block {
            background: #fff6f4;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e6dfd0;
        }

        #TimeCalculatorContainer .time-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        #TimeCalculatorContainer .time-block-title {
            font-weight: bold;
            color: #af6b35;
        }

        #TimeCalculatorContainer .remove-time-block {
            background: #ad2a24;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 2px 8px;
            cursor: pointer;
        }

        #TimeCalculatorContainer .time-calculator-row {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        #TimeCalculatorContainer .time-calculator-options-row {
            display: flex;
            align-items: center;
            gap: 14px;
            margin: 16px 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        #TimeCalculatorContainer .time-calculator-options-row label {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #af6b35;
            font-weight: 500;
            white-space: nowrap;
        }

        #TimeCalculatorContainer .time-calculator-options-row input[type="checkbox"] {
            accent-color: #af6b35;
            width: 18px;
            height: 18px;
        }

        #TimeCalculatorContainer #timeCalculatorFormat {
            padding: 6px 7px;
            font-size: 1em;
            border-radius: 6px;
            border: 1.5px solid #e6dfd0;
            background: #fff7f4;
            color: #af6b35;
            min-width: 100px;
            cursor: pointer;
        }

        #TimeCalculatorContainer #timeCalculatorFormat:focus {
            box-shadow: 0 0 6px #ad2a2422;
        }

        #TimeCalculatorContainer input[type="number"], 
        #TimeCalculatorContainer select {
            padding: 6px 7px;
            font-size: 1em;
            border-radius: 5px;
            border: 1.2px solid #e6dfd0;
            background: #fffaf7;
            color: black;
            width: 60px;
            box-sizing: border-box;
        }

        #TimeCalculatorContainer input[type="number"]:focus, 
        #TimeCalculatorContainer select:focus {
            box-shadow: 0 0 7px #ad2a2430;
        }

        #TimeCalculatorContainer .time-calculator-button-row {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        #TimeCalculatorContainer button {
            padding: 9px 19px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            min-width: 90px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        #TimeCalculatorContainer .time-calculator-primary-btn {
            background: #23b616;
            color: white;
            box-shadow: 0 2px 6px rgba(35, 182, 22, 0.2);
        }

        #TimeCalculatorContainer .time-calculator-primary-btn:hover {
            background: #1f9e14;
            transform: translateY(-2px);
        }

        #TimeCalculatorContainer .time-calculator-secondary-btn {
            background: #f0f0f0;
            color: #333;
            border: 1px solid #ccc;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        #TimeCalculatorContainer .time-calculator-secondary-btn:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }

        #TimeCalculatorContainer .time-calculator-result-block {
            background: #fff;
            border-radius: 5px;
            margin-top: 26px;
            padding: 15px 18px;
            border: 1px solid #d4c9a8;
            color: #ad2a24;
            font-size: 1.15em;
            display: none;
            box-shadow: 0 2px 8px #ad2a2430;
        }

        #TimeCalculatorContainer .time-calculator-result-block.show-result {
            display: block;
            animation: fadePop 0.4s;
        }

        @keyframes fadePop {
            0% {opacity: 0; transform: scale(0.97);}
            80% {opacity: 1; transform: scale(1.03);}
            100% {opacity: 1;}
        }

        #TimeCalculatorContainer .time-calculator-result-bold {
            font-weight: bold;
            font-size: 1.05em;
            background: #f9f5e8;
            padding: 4px 8px;
            border-radius: 7px;
            display: inline-block;
            margin-top: 6px;
        }

        #TimeCalculatorContainer .time-calculator-error {
            color: #ad2a24;
            font-weight: bold;
            font-size: 0.95em;
            margin-top: 15px;
            background: #ffe5e2;
            padding: 7px 12px;
            border-radius: 8px;
            border: 1px solid #ad2a24;
            display: none;
        }

        #TimeCalculatorContainer .time-calculator-error.show {
            display: block;
            animation: fadePop 0.3s;
        }

        @media (max-width: 480px) {
            #TimeCalculatorContainer .time-calculator-container {
                margin: 20px 12px; 
                padding: 20px 14px;
            }
            
            #TimeCalculatorContainer .time-calculator-container h2 {
                font-size: 1.7em;
            }
            
            #TimeCalculatorContainer .time-calculator-row {
                flex-direction: column; 
                align-items: stretch;
                gap: 5px;
            }
            
            #TimeCalculatorContainer input[type="number"], 
            #TimeCalculatorContainer select {
                width: 100%;
                padding: 8px 10px;
                font-size: 1.1em;
            }
            
            #TimeCalculatorContainer .time-calculator-button-row {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            
            #TimeCalculatorContainer button {
                width: 100%; 
                margin-top: 8px;
                padding: 12px;
            }
            
            #TimeCalculatorContainer .time-block {
                padding: 12px;
            }
            
            #TimeCalculatorContainer .time-calculator-options-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
        `;
        document.head.appendChild(style);
    </script>

    <script>
        const timeBlocksContainer = document.getElementById("timeBlocksContainer");
        const formatSelect = document.getElementById("timeCalculatorFormat");
        const includeSecondsCheckbox = document.getElementById("timeCalculatorIncludeSeconds");
        const addTimeBlockBtn = document.getElementById("addTimeBlockBtn");
        const calcBtn = document.getElementById("timeCalculatorCalcBtn");
        const resetBtn = document.getElementById("timeCalculatorResetBtn");
        const outputDiv = document.getElementById("timeCalculatorOutput");
        const errorDiv = document.getElementById("timeCalculatorError");

        // Create a new time block
        function createTimeBlock(index, values = {}) {
            const block = document.createElement("div");
            block.className = "time-block";
            block.dataset.index = index;
            
            const format = formatSelect.value;
            const showSeconds = includeSecondsCheckbox.checked;
            
            block.innerHTML = `
                <div class="time-block-header">
                    <div class="time-block-title">Time Period #${index + 1}</div>
                    <button class="remove-time-block">Ã—</button>
                </div>
                <section>
                    <h4>Start Time</h4>
                    <div class="time-calculator-input-block">
                        <div class="time-calculator-row" id="timeBlockStartInputs${index}"></div>
                    </div>
                </section>
                <section>
                    <h4>End Time</h4>
                    <div class="time-calculator-input-block">
                        <div class="time-calculator-row" id="timeBlockEndInputs${index}"></div>
                    </div>
                </section>
            `;
            
            // Create inputs
            const startContainer = block.querySelector(`#timeBlockStartInputs${index}`);
            const endContainer = block.querySelector(`#timeBlockEndInputs${index}`);
            
            createTimeInputs(`timeBlockStart${index}`, format, showSeconds, values.start || {}).elements.forEach(e => startContainer.appendChild(e));
            createTimeInputs(`timeBlockEnd${index}`, format, showSeconds, values.end || {}).elements.forEach(e => endContainer.appendChild(e));
            
            return block;
        }

        // Create time inputs
        function createTimeInputs(prefix, format, showSeconds, values = {}) {
            const hourInput = document.createElement("input");
            hourInput.type = "number";
            hourInput.min = format == "12" ? 1 : 0;
            hourInput.max = format == "12" ? 12 : 23;
            hourInput.value = values.hour ?? (prefix.includes("Start") ? 10 : 10);
            hourInput.placeholder = "Hour";
            hourInput.id = prefix + "Hour";
            hourInput.className = "time-calculator-hour-input";

            const minuteInput = document.createElement("input");
            minuteInput.type = "number";
            minuteInput.min = 0; 
            minuteInput.max = 59;
            minuteInput.value = values.minute ?? 0;
            minuteInput.placeholder = "Min";
            minuteInput.id = prefix + "Minute";
            minuteInput.className = "time-calculator-minute-input";

            let secondInput = null;
            if (showSeconds) {
                secondInput = document.createElement("input");
                secondInput.type = "number";
                secondInput.min = 0; 
                secondInput.max = 59;
                secondInput.value = values.second ?? 0;
                secondInput.placeholder = "Sec";
                secondInput.id = prefix + "Second";
                secondInput.className = "time-calculator-second-input";
            }

            let ampmSelect = null;
            if (format == "12") {
                ampmSelect = document.createElement("select");
                ampmSelect.id = prefix + "AMPM";
                ampmSelect.className = "time-calculator-ampm-select";
                ["AM","PM"].forEach(val => {
                    const opt = document.createElement("option");
                    opt.value = val; 
                    opt.textContent = val;
                    ampmSelect.appendChild(opt);
                });
                ampmSelect.value = values.ampm || (prefix.includes("Start") ? "AM" : "PM");
            }

            const elements = [hourInput, document.createTextNode(":"), minuteInput];
            if (showSeconds) {
                elements.push(document.createTextNode(":"));
                elements.push(secondInput);
            }
            if (format == "12") elements.push(ampmSelect);
            return {elements};
        }

        // Render all time blocks
        function renderTimeBlocks() {
            const format = formatSelect.value;
            const showSeconds = includeSecondsCheckbox.checked;
            
            // Save current values
            const blocks = [];
            document.querySelectorAll('#TimeCalculatorContainer .time-block').forEach(block => {
                const index = block.dataset.index;
                blocks.push({
                    start: getTime(`timeBlockStart${index}`),
                    end: getTime(`timeBlockEnd${index}`)
                });
            });
            
            // Clear and recreate
            timeBlocksContainer.innerHTML = "";
            if (blocks.length === 0) {
                // Add one default block if empty
                addTimeBlock();
            } else {
                blocks.forEach((block, i) => {
                    timeBlocksContainer.appendChild(createTimeBlock(i, block));
                });
            }
        }

        // Add a new time block
        function addTimeBlock() {
            const index = document.querySelectorAll('#TimeCalculatorContainer .time-block').length;
            timeBlocksContainer.appendChild(createTimeBlock(index));
        }

        // Get time values from inputs
        function getTime(prefix) {
            const format = formatSelect.value;
            const hour = Number(document.getElementById(prefix + "Hour")?.value);
            const minute = Number(document.getElementById(prefix + "Minute")?.value);
            let second = includeSecondsCheckbox.checked ? Number(document.getElementById(prefix + "Second")?.value) : 0;
            let ampm = format === "12" ? document.getElementById(prefix + "AMPM")?.value : null;
            return {hour, minute, second, ampm};
        }

        // Validate time inputs
        function validateInputs(time, format) {
            if (format == "12") {
                if (isNaN(time.hour) || !(time.hour >= 1 && time.hour <= 12)) return "Hour must be 1-12.";
            } else {
                if (isNaN(time.hour) || !(time.hour >= 0 && time.hour <= 23)) return "Hour must be 0-23.";
            }
            if (isNaN(time.minute) || !(time.minute >= 0 && time.minute <= 59)) return "Minute must be 0-59.";
            if (includeSecondsCheckbox.checked && (isNaN(time.second) || !(time.second >= 0 && time.second <= 59))) return "Second must be 0-59.";
            return "";
        }

        // Format time for display
        function formatDisplay(time, format) {
            if (format == "12") {
                return pad(time.hour) + ":" + pad(time.minute) +
                    (includeSecondsCheckbox.checked ? ":" + pad(time.second) : "") + " " + time.ampm;
            } else {
                return pad(time.hour) + ":" + pad(time.minute) + (includeSecondsCheckbox.checked ? ":" + pad(time.second) : "");
            }
        }

        // Convert to 24-hour format
        function to24Hour(hour, ampm) {
            if (ampm == "AM") return hour == 12 ? 0 : hour;
            else return hour == 12 ? 12 : hour + 12;
        }

        // Convert time to seconds
        function toSeconds(time, format) {
            let h = format == "12" ? to24Hour(time.hour, time.ampm) : time.hour;
            let m = time.minute;
            let s = includeSecondsCheckbox.checked ? time.second : 0;
            return h * 3600 + m * 60 + s;
        }

        // Pad numbers with leading zero
        function pad(n){return String(n).padStart(2, "0");}

        // Calculate total duration
        function calculateTotal() {
            errorDiv.innerHTML = "";
            errorDiv.classList.remove("show");
            outputDiv.innerHTML = "";
            outputDiv.classList.remove("show-result");

            const format = formatSelect.value;
            const blocks = [];
            let hasError = false;
            
            // Validate all blocks
            document.querySelectorAll('#TimeCalculatorContainer .time-block').forEach((block, i) => {
                const start = getTime(`timeBlockStart${i}`);
                const end = getTime(`timeBlockEnd${i}`);
                
                const errStart = validateInputs(start, format);
                const errEnd = validateInputs(end, format);
                
                if (errStart || errEnd) {
                    errorDiv.innerHTML += (errStart ? `Block ${i+1} Start: ${errStart}<br>` : "") + 
                                          (errEnd ? `Block ${i+1} End: ${errEnd}<br>` : "");
                    hasError = true;
                }
                
                if (!hasError) {
                    blocks.push({
                        start: toSeconds(start, format),
                        end: toSeconds(end, format)
                    });
                }
            });
            
            if (hasError) {
                errorDiv.classList.add("show");
                return;
            }
            
            if (blocks.length === 0) {
                errorDiv.innerHTML = "Please add at least one time block";
                errorDiv.classList.add("show");
                return;
            }
            
            // Calculate total time
            let totalSeconds = 0;
            
            blocks.forEach(block => {
                let duration = block.end - block.start;
                if (duration < 0) duration += 24 * 3600; // Handle overnight
                totalSeconds += duration;
            });
            
            // Format results
            let hours = Math.floor(totalSeconds / 3600);
            let mins = Math.floor((totalSeconds % 3600) / 60);
            let secs = totalSeconds % 60;
            
            let resultHTML = `<div style="font-weight:bold;margin-bottom:6px">Total Time:</div>
                <span class="time-calculator-result-bold">${hours} hour${hours !== 1 ? "s" : ""}, ${mins} minute${mins !== 1 ? "s" : ""}`;
            
            if (includeSecondsCheckbox.checked) {
                resultHTML += `, ${secs} second${secs !== 1 ? "s" : ""}`;
            }
            resultHTML += `</span>`;
            
            // Add details for each block
            resultHTML += `<div style="margin-top:15px;font-size:0.95em">`;
            blocks.forEach((block, i) => {
                const start = getTime(`timeBlockStart${i}`);
                const end = getTime(`timeBlockEnd${i}`);
                
                resultHTML += `<div style="margin-top:8px;">
                    <b>Block ${i+1}:</b> ${formatDisplay(start, format)} to ${formatDisplay(end, format)}</div>`;
            });
            resultHTML += `</div>`;
            
            outputDiv.innerHTML = resultHTML;
            outputDiv.classList.add("show-result");
        }

        // Reset calculator
        function reset() {
            formatSelect.value = "12";
            includeSecondsCheckbox.checked = false;
            timeBlocksContainer.innerHTML = "";
            addTimeBlock(); // Add one default block
            errorDiv.innerHTML = "";
            outputDiv.innerHTML = "";
            errorDiv.classList.remove("show");
            outputDiv.classList.remove("show-result");
        }

        // Initialize
        function init() {
            // Event listeners
            formatSelect.addEventListener("change", renderTimeBlocks);
            includeSecondsCheckbox.addEventListener("change", renderTimeBlocks);
            addTimeBlockBtn.addEventListener("click", addTimeBlock);
            calcBtn.addEventListener("click", calculateTotal);
            resetBtn.addEventListener("click", reset);
            
            // Handle remove time block via event delegation
            timeBlocksContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-time-block')) {
                    const block = e.target.closest('.time-block');
                    if (block) {
                        block.remove();
                        // Reindex remaining blocks
                        document.querySelectorAll('#TimeCalculatorContainer .time-block').forEach((block, i) => {
                            block.dataset.index = i;
                            block.querySelector('.time-block-title').textContent = `Time Period #${i + 1}`;
                        });
                    }
                }
            });
            
            // Add first time block
            reset();
        }

        // Start the app
        init();
    </script>
</body>
</html>